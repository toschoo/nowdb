/* ========================================================================
 * (c) Tobias Schoofs, 2018
 * ========================================================================
 * Lock: mutual exclusion and read/write locks
 * ========================================================================
 *
 * ========================================================================
 */
#ifndef nowdb_lock_decl
#define nowdb_lock_decl

#include <nowdb/types/types.h>
#include <nowdb/types/error.h>

#include <pthread.h>

/* ------------------------------------------------------------------------
 * Exclusive Lock
 * ------------------------------------------------------------------------
 */
typedef pthread_mutex_t nowdb_lock_t;

/* ------------------------------------------------------------------------
 * Read/Write Lock
 * ------------------------------------------------------------------------
 */
typedef pthread_rwlock_t nowdb_rwlock_t;

/* ------------------------------------------------------------------------
 * Initialise Exclusive Lock
 * ------------------------------------------------------------------------
 */
nowdb_err_t nowdb_lock_init(nowdb_lock_t *lock);

/* ------------------------------------------------------------------------
 * Initialise Read/Write Lock
 * ------------------------------------------------------------------------
 */
nowdb_err_t nowdb_rwlock_init(nowdb_rwlock_t *lock);

/* ------------------------------------------------------------------------
 * Destroy Exclusive Lock
 * ------------------------------------------------------------------------
 */
void nowdb_lock_destroy(nowdb_lock_t *lock);

/* ------------------------------------------------------------------------
 * Destroy Read/Write Lock
 * ------------------------------------------------------------------------
 */
void nowdb_rwlock_destroy(nowdb_rwlock_t *lock);

/* ------------------------------------------------------------------------
 * Lock Exclusive Lock
 * ------------------------------------------------------------------------
 */
nowdb_err_t nowdb_lock(nowdb_lock_t *lock);

/* ------------------------------------------------------------------------
 * Unlock Exclusive Lock
 * ------------------------------------------------------------------------
 */
nowdb_err_t nowdb_unlock(nowdb_lock_t *lock);

/* ------------------------------------------------------------------------
 * Lock Read Lock
 * ------------------------------------------------------------------------
 */
nowdb_err_t nowdb_lock_read(nowdb_rwlock_t *lock);

/* ------------------------------------------------------------------------
 * Unlock Read Lock
 * ------------------------------------------------------------------------
 */
nowdb_err_t nowdb_unlock_read(nowdb_rwlock_t *lock);

/* ------------------------------------------------------------------------
 * Lock Write Lock
 * ------------------------------------------------------------------------
 */
nowdb_err_t nowdb_lock_write(nowdb_rwlock_t *lock);

/* ------------------------------------------------------------------------
 * Unlock Write Lock
 * ------------------------------------------------------------------------
 */
nowdb_err_t nowdb_unlock_write(nowdb_rwlock_t *lock);

#endif

